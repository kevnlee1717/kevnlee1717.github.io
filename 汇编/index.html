<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>汇编 | 读书笔记</title>
    <meta name="description" content="blog for important">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/assets/css/0.styles.6b1fcd0f.css" as="style"><link rel="preload" href="/assets/js/app.9eeb4c04.js" as="script"><link rel="preload" href="/assets/js/2.05f5c699.js" as="script"><link rel="preload" href="/assets/js/77.0236f6e7.js" as="script"><link rel="prefetch" href="/assets/js/10.ce5629fc.js"><link rel="prefetch" href="/assets/js/11.9773dffd.js"><link rel="prefetch" href="/assets/js/12.cb235449.js"><link rel="prefetch" href="/assets/js/13.838af8c1.js"><link rel="prefetch" href="/assets/js/14.0f78d55e.js"><link rel="prefetch" href="/assets/js/15.7b28f3cf.js"><link rel="prefetch" href="/assets/js/16.bd9e6d20.js"><link rel="prefetch" href="/assets/js/17.d8687edf.js"><link rel="prefetch" href="/assets/js/18.306806ea.js"><link rel="prefetch" href="/assets/js/19.ab35d666.js"><link rel="prefetch" href="/assets/js/20.d0795bc0.js"><link rel="prefetch" href="/assets/js/21.4528c5b9.js"><link rel="prefetch" href="/assets/js/22.d2153363.js"><link rel="prefetch" href="/assets/js/23.d7c71f27.js"><link rel="prefetch" href="/assets/js/24.a9e1c254.js"><link rel="prefetch" href="/assets/js/25.15696c77.js"><link rel="prefetch" href="/assets/js/26.4bbfc20d.js"><link rel="prefetch" href="/assets/js/27.1a8b8d41.js"><link rel="prefetch" href="/assets/js/28.81f62634.js"><link rel="prefetch" href="/assets/js/29.15767945.js"><link rel="prefetch" href="/assets/js/3.512ca8e1.js"><link rel="prefetch" href="/assets/js/30.e956e5bf.js"><link rel="prefetch" href="/assets/js/31.c9fa876d.js"><link rel="prefetch" href="/assets/js/32.79554d08.js"><link rel="prefetch" href="/assets/js/33.a6cfbf61.js"><link rel="prefetch" href="/assets/js/34.b6f8901e.js"><link rel="prefetch" href="/assets/js/35.ab673e8f.js"><link rel="prefetch" href="/assets/js/36.f5ee7dc3.js"><link rel="prefetch" href="/assets/js/37.40e0320b.js"><link rel="prefetch" href="/assets/js/38.6cb6a27b.js"><link rel="prefetch" href="/assets/js/39.ff4a30ed.js"><link rel="prefetch" href="/assets/js/4.00b5f0c7.js"><link rel="prefetch" href="/assets/js/40.478ea2a9.js"><link rel="prefetch" href="/assets/js/41.64fdc8de.js"><link rel="prefetch" href="/assets/js/42.514e254b.js"><link rel="prefetch" href="/assets/js/43.e2c263a3.js"><link rel="prefetch" href="/assets/js/44.e01d7fb4.js"><link rel="prefetch" href="/assets/js/45.a2fddd2d.js"><link rel="prefetch" href="/assets/js/46.8282db21.js"><link rel="prefetch" href="/assets/js/47.a7e1170f.js"><link rel="prefetch" href="/assets/js/48.fe61ca73.js"><link rel="prefetch" href="/assets/js/49.34cbcda0.js"><link rel="prefetch" href="/assets/js/5.59abda55.js"><link rel="prefetch" href="/assets/js/50.38e400ea.js"><link rel="prefetch" href="/assets/js/51.03cc45e4.js"><link rel="prefetch" href="/assets/js/52.f133d9c7.js"><link rel="prefetch" href="/assets/js/53.ada00766.js"><link rel="prefetch" href="/assets/js/54.24a05a9c.js"><link rel="prefetch" href="/assets/js/55.204b6e5c.js"><link rel="prefetch" href="/assets/js/56.13a2207f.js"><link rel="prefetch" href="/assets/js/57.a252ceca.js"><link rel="prefetch" href="/assets/js/58.315067a8.js"><link rel="prefetch" href="/assets/js/59.0026ba95.js"><link rel="prefetch" href="/assets/js/6.fccdfb42.js"><link rel="prefetch" href="/assets/js/60.30c08c7c.js"><link rel="prefetch" href="/assets/js/61.87d9ca75.js"><link rel="prefetch" href="/assets/js/62.30b4fffc.js"><link rel="prefetch" href="/assets/js/63.44cd0bb8.js"><link rel="prefetch" href="/assets/js/64.29caf405.js"><link rel="prefetch" href="/assets/js/65.5280d5cd.js"><link rel="prefetch" href="/assets/js/66.c1aa3043.js"><link rel="prefetch" href="/assets/js/67.7baea68b.js"><link rel="prefetch" href="/assets/js/68.d202f339.js"><link rel="prefetch" href="/assets/js/69.9b34bf67.js"><link rel="prefetch" href="/assets/js/7.1753504c.js"><link rel="prefetch" href="/assets/js/70.0569eace.js"><link rel="prefetch" href="/assets/js/71.464aeeb3.js"><link rel="prefetch" href="/assets/js/72.b7ec61d5.js"><link rel="prefetch" href="/assets/js/73.afd82e65.js"><link rel="prefetch" href="/assets/js/74.6bf26649.js"><link rel="prefetch" href="/assets/js/75.97d4b5c5.js"><link rel="prefetch" href="/assets/js/76.ae4be9dc.js"><link rel="prefetch" href="/assets/js/78.de45f505.js"><link rel="prefetch" href="/assets/js/79.74474488.js"><link rel="prefetch" href="/assets/js/8.7d851339.js"><link rel="prefetch" href="/assets/js/80.5c82a395.js"><link rel="prefetch" href="/assets/js/81.310b0fe4.js"><link rel="prefetch" href="/assets/js/82.11228b74.js"><link rel="prefetch" href="/assets/js/83.2c92d02f.js"><link rel="prefetch" href="/assets/js/84.b1209e24.js"><link rel="prefetch" href="/assets/js/9.e24e4f73.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b1fcd0f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">读书笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/uni-app/" class="nav-link">
  uni
</a></div><div class="nav-item"><a href="/es6/" class="nav-link">
  es6
</a></div><div class="nav-item"><a href="/python/" class="nav-link">
  py
</a></div><div class="nav-item"><a href="/tp5/" class="nav-link">
  tp5
</a></div><div class="nav-item"><a href="/docker/" class="nav-link">
  dock
</a></div><div class="nav-item"><a href="/face/" class="nav-link">
  face
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">
  csharp
</a></div><div class="nav-item"><a href="/c++/" class="nav-link">
  c++
</a></div><div class="nav-item"><a href="/arm/" class="nav-link">
  arm
</a></div><div class="nav-item"><a href="/wechat/" class="nav-link">
  wechat
</a></div><div class="nav-item"><a href="/汇编/" class="nav-link">
  汇编
</a></div><div class="nav-item"><a href="/unix/" class="nav-link">
  unix
</a></div><div class="nav-item"><a href="/资源/" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/摄影/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="/加密币/" class="nav-link">
  加密币
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/uni-app/" class="nav-link">
  uni
</a></div><div class="nav-item"><a href="/es6/" class="nav-link">
  es6
</a></div><div class="nav-item"><a href="/python/" class="nav-link">
  py
</a></div><div class="nav-item"><a href="/tp5/" class="nav-link">
  tp5
</a></div><div class="nav-item"><a href="/docker/" class="nav-link">
  dock
</a></div><div class="nav-item"><a href="/face/" class="nav-link">
  face
</a></div><div class="nav-item"><a href="/android/" class="nav-link">
  android
</a></div><div class="nav-item"><a href="/csharp/" class="nav-link">
  csharp
</a></div><div class="nav-item"><a href="/c++/" class="nav-link">
  c++
</a></div><div class="nav-item"><a href="/arm/" class="nav-link">
  arm
</a></div><div class="nav-item"><a href="/wechat/" class="nav-link">
  wechat
</a></div><div class="nav-item"><a href="/汇编/" class="nav-link">
  汇编
</a></div><div class="nav-item"><a href="/unix/" class="nav-link">
  unix
</a></div><div class="nav-item"><a href="/资源/" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/摄影/" class="nav-link">
  摄影
</a></div><div class="nav-item"><a href="/加密币/" class="nav-link">
  加密币
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/%E6%B1%87%E7%BC%96/" class="active sidebar-link">汇编</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#c中的参数引用" class="sidebar-link">c中的参数引用</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#c与指针" class="sidebar-link">c与指针</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#c语言参数内存布局" class="sidebar-link">c语言参数内存布局</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#offset" class="sidebar-link">offset</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#jmp指令" class="sidebar-link">jmp指令</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#程序在内存中的布局" class="sidebar-link">程序在内存中的布局</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#_20根地址线" class="sidebar-link">20根地址线</a></li><li class="sidebar-sub-header"><a href="/%E6%B1%87%E7%BC%96/#段寄存器的设计和寻址方式" class="sidebar-link">段寄存器的设计和寻址方式</a></li></ul></li><li><a href="/汇编/代码.html" class="sidebar-link">代码</a></li><li><a href="/汇编/寄存器.html" class="sidebar-link">寄存器</a></li><li><a href="/汇编/编译器.html" class="sidebar-link">编译器</a></li><li><a href="/汇编/DOSBOX.html" class="sidebar-link">dosbox</a></li><li><a href="/汇编/OllyDbg.html" class="sidebar-link">OllyDbg</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="汇编"><a href="#汇编" class="header-anchor">#</a> 汇编</h1> <h2 id="c中的参数引用"><a href="#c中的参数引用" class="header-anchor">#</a> c中的参数引用</h2> <ul><li><p>参数 从右到左依次入栈</p></li> <li><p>当看到一个变量定义的时候， 数据类型只是说明在内存中占用了几个字节， char 1个字节， int 4个字节， short 2个字节。 一个内存地址都是以一个字节大小。换句话说即是步进的大小不同。 如果进行内存寻址的时候，要说明需要寻址的大小.</p></li> <li><p>内存寻址 比如 [xx] 在对这个地址寻址的时候如果不做 word ptr [xx] 或者 dword ptr [xx] 声明，那么默认就是 byte ptr [xx], 就是一个字节的。 mov [xx], 0x55667788 ， byte ptr 的时候只存了 88， word ptr只存了 7788， dword 是55667788。</p></li> <li><p>char* a = xx;  char *说明a里面存的是地址，而不是平常的数据类型而已， a 跟其他变量声明一样，只是一个内存地址的别名, char 说明这个地址的步进是1 ，如果是int 步进是2.</p> <ul><li>char** a = '123'; 说明a(bp-2)存的值是一个地址ffdd，而(ffdd)里存的也是一个地址ffcc,最终(ffcc)里存的才是具体的数据 '123'的地址(ds:0194)。 所以*a 就解析a存的地址(ffdd),可以对(ffdd)里面的值进行修改先的值是ffcc，如果修改后就指向了其他地址， **a就是对(ffdd)里的值ffcc再进行寻址，(ffcc)里现在存的是(ds:0194)可以对最终的数据进行修改。</li></ul></li> <li><p>进入函数后 bp = sp， bp处的值就是调用它的函数的bp值。 [bp+2]就是函数结束后的 ip</p></li> <li><p>局部变量的存在 都是 push到栈里才得到它的地址空间，这个地址就是变量定义时候的名字的别名。</p></li> <li><p>函数开始后对栈的使用，需要使用的寄存器都会先push起来， 是寄存器push在前还是局部变量开辟在前，顺序不确定？？</p></li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token operator">*</span> a <span class="token operator">=</span> <span class="token string">'123'</span> <span class="token comment">// a的地址 = bp-2 = ffbc ， a的值= '123'的地址 0194</span>
    <span class="token keyword">char</span><span class="token operator">*</span> b <span class="token operator">=</span> <span class="token string">'abc'</span> <span class="token comment">// b的地址 = bp-4 = ffba ， a的值= 'abc'的地址 0198</span>

    <span class="token comment">//变量名称a,b在内存中就是一个地址，如果是全局变量就是data段中的地址，局部变量就是栈中的一个地址</span>

    <span class="token comment">//a,b的值是地址，那它就是一个指针，*a即[a]通过存在a地址中的地址去获取真实的数据</span>
    <span class="token comment">//char** a,a的值是一个地址，*a即[a]获取到第2个地址，**a即[[a]]获取到真实数据，以此类推</span>

    <span class="token comment">//a,b的值就是int,char..等类型数据的值，那么a,b地址里存的就是数据，可以直接读写</span>

    <span class="token function">notchanged</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//当开始调用函数的时候，先push两个参数a和b的值进栈，如果main函数中的a,b地址是当前bp</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">'%c'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从a(bp-2)处的值 （0194地址) 的字符串打印出来</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">'%c'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从b(bp-4)处的值 （0198地址) 的字符串打印出来</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">noswap</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span>b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

  

<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><table><thead><tr><th style="text-align:center;">swaps栈</th> <th>内容</th> <th>bp</th> <th>sp</th> <th>函数</th> <th>注释</th></tr></thead> <tbody><tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">ffd8</td> <td>是否初始化？</td> <td></td> <td>sp（空出4个字节）</td> <td>main</td> <td>sub sp,04 栈中开辟两个字的空间，用来存储两个局部变量a，b，这里bp-2</td></tr> <tr><td style="text-align:center;">ffdc</td> <td>org_bp=ffe8</td> <td>bp=ffdc</td> <td>sp</td> <td>main</td> <td>push bp, mov bp,sp 保存原来的bp，更新bp， 所以现在的bp值就是调用main函数的bp值。等main返回的时候可以恢复栈。</td></tr> <tr><td style="text-align:center;">ffde</td> <td>xx</td> <td></td> <td>sp</td> <td>main</td> <td>刚刚进入main函数t</td></tr></tbody></table> <table><thead><tr><th style="text-align:center;">noswap栈</th> <th>内容</th> <th>bp</th> <th>sp</th> <th>函数</th> <th>注释</th></tr></thead> <tbody><tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td> <td>x</td></tr> <tr><td style="text-align:center;">x</td> <td>x</td> <td>x</td> <td>x</td> <td>noswap</td> <td>接着用 【bp-2】的局部变量temp,对si,di进行了交换，printf的时候也直接使用了di，si。 所以在noswap函数内部产生了交换，但是在main函数里， 【bp-6】 （局部变量b）的值 与 【bp-8】（局部变量a）的值并没有改变。</td></tr> <tr><td style="text-align:center;"></td> <td></td> <td></td> <td></td> <td>noswap</td> <td>mov si,[bp+04] 传入的a参数，根据bp+4,把main里局部变量a的值赋值给寄存器si，noswap函数对传入的参数，没有开辟新的栈或者内存地址，直接使用一个si寄存器，这样速度更快，在很多参数或者其他类型的是否会使用栈？</td></tr> <tr><td style="text-align:center;"></td> <td></td> <td></td> <td></td> <td>noswap</td> <td>mov di,[bp+06] 传入的b参数，根据bp+6,把main里局部变量b的值赋值给寄存器di，noswap函数对传入的参数，没有开辟新的栈或者内存地址，直接使用一个di寄存器，这样速度更快，在很多参数或者其他类型的是否会使用栈？</td></tr> <tr><td style="text-align:center;">ffca</td> <td>198</td> <td></td> <td>sp</td> <td>noswap</td> <td>push di 要使用到si 进行保存</td></tr> <tr><td style="text-align:center;">ffcc</td> <td>194</td> <td></td> <td>sp</td> <td>noswap</td> <td>push si 要使用到si 进行保存</td></tr> <tr><td style="text-align:center;">ffce</td> <td>3346</td> <td></td> <td>sp</td> <td>noswap</td> <td>sub sp, 02 对sp指针修改 保存这个3346是什么？？ 是局部变量temp 为什么初始化为3346？？？</td></tr> <tr><td style="text-align:center;">ffd0</td> <td>org_bp=ffdc</td> <td>bp</td> <td>sp</td> <td>noswap</td> <td>push bp , mov bp,sp 进入call第一步先保存bp，然后马上更新bp为当前sp，所以在一个被调用函数里当前bp里的值就是调用函数的bp地址。 bp+2 就是函数结束后的ip地址</td></tr> <tr><td style="text-align:center;">ffd2</td> <td>ip=020A</td> <td></td> <td>sp</td> <td>main</td> <td>call xxxx, 在main中的时候先 push ip, 执行了call指令，准备进入，call指令后的第一个IP是020a入栈，等call返回时候执行</td></tr> <tr><td style="text-align:center;">ffd4</td> <td>si,194</td> <td></td> <td>sp</td> <td>main</td> <td>mov si,194 push si  为局部变量a 在栈中开辟地址给它，push si 就是在栈中存储局部变量a同时值为字符串&quot;123&quot;在data段中的地址0194，局部变量后面的先入栈194</td></tr> <tr><td style="text-align:center;">ffd6</td> <td>di,198</td> <td></td> <td>sp</td> <td>main</td> <td>mov di,198 push di  为局部变量b 在栈中开辟地址给它，push di 就是在栈中存储局部变量b同时值为字符串&quot;abc&quot;在data段中的地址0198，局部变量后面的先入栈</td></tr> <tr><td style="text-align:center;">ffd8</td> <td>di，xx</td> <td></td> <td>sp</td> <td>main</td> <td>push di 保存好di,因为要修改di，main运行前的di值</td></tr> <tr><td style="text-align:center;">ffda</td> <td>si，xx</td> <td></td> <td>sp</td> <td>main</td> <td>push si 保存好si,因为要修改si，main运行前的si值</td></tr> <tr><td style="text-align:center;">ffdc</td> <td>xx</td> <td>bp=ffdc</td> <td>sp</td> <td>main</td> <td>刚刚进入main</td></tr></tbody></table> <h2 id="c与指针"><a href="#c与指针" class="header-anchor">#</a> c与指针</h2> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>
char* addc <span class="token attr-value"><span class="token punctuation">=</span> &amp;a ;addc是字节型指针，偏移为1个字节</span>
int* addi <span class="token attr-value"><span class="token punctuation">=</span>&amp;a ;addi是字型指针，偏移为2个字节</span>

(int*)addc ;把 char指针，解析位int 指针，偏移就以2个字节

(char far*) addf <span class="token attr-value"><span class="token punctuation">=</span> 0x20001000 ;addf是一个字节型指针， 段地址2000 偏移为1000</span>

<span class="token constant">(char*)0x2000</span> <span class="token attr-value"><span class="token punctuation">=</span> '1' ;直接向这个地址 ds:[2000] 写入一个字节 61</span>
<span class="token constant">(int*)0x2000</span> <span class="token attr-value"><span class="token punctuation">=</span> '1' ;直接向这个地址 ds:[2000] 写入一个字 61 00</span>

<span class="token constant">_AX</span> <span class="token attr-value"><span class="token punctuation">=</span> 0x2000</span>
<span class="token constant">(int*)_AX</span> <span class="token attr-value"><span class="token punctuation">=</span> '1' ;设置好寄存器后，用寄存器设置地址 ds:[2000] 写入一个字 61 00</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="c语言参数内存布局"><a href="#c语言参数内存布局" class="header-anchor">#</a> c语言参数内存布局</h2> <p>对于全局变量放在data段</p> <p>所有的局部变量 都在栈中</p> <p>main 函数里的变量也是局部变量，所以也都是 [bp-xx] 格式</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>
mov word ptr [bp-xx], 0194 
<span class="token comment">; 局部变量指针， 把指针的值即字符串的地址 存入栈</span>
<span class="token comment">; char * char_poniter = '12345'</span>
<span class="token comment">; char * char_poniter = 0x194(保存的实际上是ds段的偏移地址 ds:[194]) </span>
<span class="token comment">; char * 说明 char_pointer 存的是8位的地址，实际上是一个偏移地址如上</span>
 
mov word ptr [bp-xx], 61  
<span class="token comment">;局部变量直接把值存在栈中 int a = 0x61</span>

mov wor ptr [xx], 62
<span class="token comment">;全局变量存在data段中 b = 0x62 b定义在main外面为全局变量</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="offset"><a href="#offset" class="header-anchor">#</a> offset</h2> <p>计算代码段 标识符的偏移 比如 offset start 就为0</p> <h2 id="jmp指令"><a href="#jmp指令" class="header-anchor">#</a> jmp指令</h2> <p>跳转指令是根据 跳转指令 的下一条指令 加上指令中的偏移来计算新的IP的地址</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>
j1: mov 100h

jmp j1  ;eaxx xx是偏移量，在编译的时候计算出

nop     ; nop的地址(nop shi jmp后的指令) + xx <span class="token attr-value"><span class="token punctuation">=</span> 新的IP </span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><p>jmp 一般都是短跳转 -128 到 127 地址之间进行跳转 jmp short xx</p> <p>有条件的跳转都是短跳转 jcxz</p></li> <li><p>jmp near xx 是远跳转 在 -3xxxx 到 3xxxx之间跳转</p></li> <li><p>jmp dword/word ds:[0] 是word的时候 内存地址是ip， 是dword的时候 ds:[0]是ip ds:[2]是cs</p> <p>跳转可以从内存中读取要跳转的地址，可以把要跳转的地址连续的写在一段内存中，方便跳转。</p></li></ul> <h2 id="程序在内存中的布局"><a href="#程序在内存中的布局" class="header-anchor">#</a> 程序在内存中的布局</h2> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>data segment    ;这些都是伪指令，方便用 mov ax,data 这样把数据段读进来
    .....       ;程序在内存中从这里开始，存储这里的数据开始
data ends

stack segment stack
    ....
stack ends

code segment
    ....        
<span class="token comment">    ;这里如果有start伪指令，就cs默认从这里开始，不然就从data segment 那里的那个地址开始</span>
code ends

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_20根地址线"><a href="#_20根地址线" class="header-anchor">#</a> 20根地址线</h2> <p>8086的寄存器都是16位的，但是地址线却有20条（位），所以用段地址左偏移一位加上偏移地址来表示20位的物理地址。 这样的设计应该是为了引入段地址的概念，跟实际的用户程序结合起来，每个程序都有自己的代码段，数据段，栈。 用段地址来区分，同时进行安全上的管理。</p> <h2 id="段寄存器的设计和寻址方式"><a href="#段寄存器的设计和寻址方式" class="header-anchor">#</a> 段寄存器的设计和寻址方式</h2> <p>因为程序不可以对内存向任意地址进行读写，这样会导致数据损坏操作系统崩溃，所以用户程序都由操作系统来运行，操作系统对内存空间进行划分，内核空间和用户空间。不同的用户程序不会产生干扰，不会随意的对内核空间进行读写。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9eeb4c04.js" defer></script><script src="/assets/js/2.05f5c699.js" defer></script><script src="/assets/js/77.0236f6e7.js" defer></script>
  </body>
</html>
